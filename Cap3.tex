\chapter{Sistema de control de acceso por reconocimiento de voz}

Para el desarrollo del sistema se utilizará la metodología propuesta por \citep{tammy} , la cual toma mucha de las claves de las metodologías conocidas como RUP (Rational Unified Process), ADD (Attribute Driven Desing), OPP (Object Oriented Process) y el MDA (Model Driven Architecture), pero las simplifica. La Figura \ref{fig:figura3.1} muestra las diferentes fases de la metodología, la cual es definida por el autor como el \textit{Diseño del Sistema Empotrado y el Modelo del Ciclo de Vida del Desarrollo}.

\begin{figure}[H]
\begin{center}
\includegraphics[width=1.0\textwidth]{Imagenes/Cap3/image001}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Diseño del sistema empotrado y el modelo del ciclo de vida del desarrollo.}}
\label{fig:figura3.1}
{\small{Fuente: \cite{tammy}}}
\end{center}
\end{figure}

Como se puede ver en la Figura \ref{fig:figura3.1}, en el diseño de un sistema empotrado, según la metodología de \cite{tammy}, se pueden distinguir 4 fases: 
\begin{enumerate}
\item[-]\textbf{Fase 1. Creación de la arquitectura}, el cual es el proceso de planear el diseño del sistema empotrado.
\item[-]\textbf{Fase 2. Implementación de la arquitectura}, el cual es el proceso de desarrollar el sistema empotrado. 
\item[-]\textbf{Fase 3. Testeo del sistema}, el cual es el proceso de testear el sistema empotrado para buscar problemas y luego solucionarlos. 
\item[-]\textbf{Fase 4. Mantenimiento del sistema}, el cual es el proceso de desplegar el sistema empotrado en el mercado, y proveerlo de soporte técnico para los usuarios del dispositivo por la duración del tiempo de vida del mismo.
\end{enumerate}

\section{Fase 1. Creación de la arquitectura}
Esta fase se divide en 3 etapas:
\begin{enumerate}
\item[-]Etapa 1: Tener una base técnica sólida.
\item[-]Etapa 2: Entender el ciclo de negocio de la arquitectura.
\item[-]Etapa 3: Definir los patrones arquitectónicos y modelos de referencia.
\end{enumerate}

\subsection{Etapa 1: Tener una base técnica sólida}
Esta etapa tiene como fundamento la base cognitiva de los autores de la presente tesis y ha sido descrita tanto en el título, introducción y marco teórico.

\subsection{Etapa 2: Entender el ciclo de negocio de la arquitectura}
En la Figura \ref{fig:figura3.2} vemos que el ciclo de negocio de la arquitectura de un sistema empotrado son los diferentes tipos de influencias los que generan los requerimientos del sistema, los requerimientos a su vez generan la arquitectura, luego esta produce el sistema y el sistema resultante a su vez provee los requerimientos y capacidades devuelta a la organización para futuros diseños.
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.5\textwidth]{Imagenes/Cap3/image002}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Ciclo de negocio de la arquitectura.}}
\label{fig:figura3.2}
{\small{Fuente: \cite{tammy}}}
\end{center}
\end{figure}

Una vez entendido el ciclo de negocio de la arquitectura, se debe plasmar la información obtenida de varias influencias, que en otras palabras son los requerimientos. La presente metodología propone hacerlo mediante la tabla general de características del ciclo de negocio de la arquitectura o el uso de prototipos. Se eligió representar los requerimientos mediante la tabla general de características del ciclo de negocio de la arquitectura, ver la Tabla \ref{table:tabla3.1}.

\begin{center}
\begin{table}[H]
\centering
\caption{\small{Características generales del ciclo de negocio de la arquitectura.}}
\label{table:tabla3.1}
\vskip 0.2cm
\begin{tabular}{|p{3cm}|p{4cm}|p{6cm}|p{3cm}|}
\hline
{\small Influencia} & {\small Característica} & {\small Descripción}  \\ 
\hline 
{\small \multirow{3}{4em}{Negocios}} & {\small Costo} & {\small El sistema de seguridad para el control de acceso por medio de la voz, debe tener un costo de desarrollo menor a los S/. 500.}  \\ 
\cline{2-3}
 & {\small Objetivo de Mercado} & {\small El sistema a diseñar es del tipo de módulo reconocedor de la voz y está dirigido al control de acceso, sin embargo, puede ser usado para el control de cualquier otro objeto.}  \\ 
\cline{2-3}
 & {\small Capacidad} & {\small El sistema debe poder reconocer la voz con una tasa de acierto del 95\%. El sistema debe poder controlar los accesos para nuevos usuarios. El sistema debe poder dar información de todos los accesos que tuvo un usuario. El sistema debe poder permitir o denegar el acceso a un usuario. El sistema debe ser capaz de trabajar en ambientes con ruido no mayores a 80 dBC.
} \\
\hline 
{\small \multirow{4}{4em}{Técnicos}} & {\small Desempeño} & {\small El sistema debe ser capaz de reconocer la voz de un locutor en un tiempo menor o igual a 5 segundos. Sin embargo, la rapidez de respuesta del sistema dependerá de la cantidad de usuarios registrados en el sistema}  \\ 
\cline{2-3}
 & {\small Amistad con Usuario} & {\small La interfaz de usuario del sistema no será muy compleja, y solo mostrará lo necesario para su manipulación.}  \\ 
\cline{2-3}
 & {\small Modificabilidad} & {\small La modificación dependerá únicamente de los desarrolladores del software}  \\ 
\cline{2-3}
 & {\small Portabilidad} & {\small El sistema podrá ser usado por cualquier dispositivo móvil Android superior a 4.4
y menor a 9.0, por lo que será portable para la mayoría de los dispositivos existentes en el mercado aproximadamente el 95\%.}  \\ 
\hline 
\end{tabular} 
\begin{center}
\vskip 0.2cm
{\small{Fuente: Elaboración propia}}
\end{center}
\end{table}
\end{center}

\subsection{Etapa 3: Definir el patrón arquitectónico y modelo de referencia}
El patrón arquitectónico a usar será el patrón arquitectónico en capas y el modelo de referencia será el modelo de referencia de sistemas empotrados, definido en \citep{tammy}. El modelo de referencia para un sistema empotrado está construido en capas y no es más que una distribución topológica de los elementos del patrón arquitectónico en capas, se define que todo sistema empotrado está formado por tres capas: de hardware, de software de sistema y de aplicación.

\begin{enumerate}
\item[a)]Capa de hardware
\par
Esta capa estará formada principalmente por un microcontrolador Arduino, el cual alojará el controlador para la activación de la cerradura eléctrica por medio del módulo relé, además este se acoplará con el módulo Ethernet Shield, lo que permitirá conectarse a un router para poder establecer así la comunicación con el dispositivo móvil.

\item[b)]Capa de software de sistema
\par
Esta capa estará formada por el controlador para la activación de la cerradura eléctrica y por el servidor para poder establecer la comunicación con la aplicación de reconocimiento de voz alojado en el dispositivo móvil.

\item[c)]Capa de software de aplicación
\par
El sistema estará formado por hardware de propósito específico, diseñado solamente para la demostración de la aplicación de reconocimiento de voz, el cual estará compuesto por 3 módulos: preprocesamiento, entrenamiento y reconocimiento de la señal de voz.

\item[d)]Modelo de referencia
\par
El modelo de referencia servirá para aproximarse al posible hardware y software que deberá contener el sistema incorporando elementos relativos. La Figura \ref{fig:figura3.3} muestra el modelo de referencia del sistema de seguridad para el control de acceso por reconocimiento de voz.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.43\textwidth]{Imagenes/Cap3/image003}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Modelo de referencia del sistema.}}
\label{fig:figura3.3}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\end{enumerate}

\section{Fase 2. Implementación de la arquitectura}
\subsection{Desarrollo del software de aplicación}
\subsubsection{Software de reconocimiento de voz}
Primero se implementará una aplicación de escritorio en lenguaje Java, este nos permitirá evaluar y testear el algoritmo de reconocimiento de voz encontrando así las mejores funciones y los parámetros adecuados para un correcto y eficiente funcionamiento del reconocimiento de voz, para luego, finalmente ser llevado a una aplicación Android, el cual servirá como interfaz entre el usuario y el sistema. A continuación, se mostrará algunos codigos fuente de los algoritmos más importantes que usaremos para nuestro sistema de reconocimiento de voz.

\begin{enumerate}
\item[a)]Filtro preénfasis
\par
En la Figura \ref{fig:figura3.10} se muestra la función para el filtro de preénfasis definida en la Ecuación \eqref{eq:ecuacion32}, donde $vEntrada$ es el vector de datos de la señal a filtrar y $alfa$ el parámetro de preénfasis.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.7\textwidth]{Imagenes/Cap3/image010}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función del filtro de preénfasis.}}
\label{fig:figura3.10}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\item[b)]Eliminación de ruido
\par
En la Figura \ref{fig:figura3.8} podemos ver la función del algoritmo NLMS definido por las Ecuaciones \eqref{eq:ecuacion10}, \eqref{eq:ecuacion11}, \eqref{eq:ecuacion12} y \eqref{eq:ecuacion13}, donde $beta/DEN$ es el factor de convergencia, $nord$ el tamaño del filtro y $a0$ el vector de pesos inicial.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.6\textwidth]{Imagenes/Cap3/image008}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente del algoritmo NLMS.}}
\label{fig:figura3.8}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\item[c)]Detección de inicio y fin de la señal de voz
\par
En la Figura \ref{fig:figura3.17} se muestra el algoritmo de Rabiner y Sambur de Tipo 1, definido por las Ecuaciones \eqref{eq:ecuacion22}, \eqref{eq:ecuacion23}, \eqref{eq:ecuacion24}, \eqref{eq:ecuacion25} y \eqref{eq:ecuacion26}, teniendo como entradas a $vEntrada$ que es el vector de datos de la señal y $tamTrana$ que es la longitud de la trama con la que se hará la evaluación, retornando el punto de inicio o fin de la voz en la señal según sea el caso.

\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image017}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente del algoritmo Rabiner y Sambur Tipo 1.}}
\label{fig:figura3.17}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\item[d)]Segmentación
\par
En la Figura \ref{fig:figura3.19} se muestra la función para la segmentación de una señal definida por las Ecuaciones \eqref{eq:ecuacion33} y \eqref{eq:ecuacion34}, además se aplica un ponderado por una ventana.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image019}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función para la segmentación de una señal.}}
\label{fig:figura3.19}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\item[e)]Transformada rápida de Fourier
\par
En la Figura \ref{fig:figura3.23} se muestra la función para la transformada rápida de Fourier, definida por las Ecuación \eqref{eq:ecuacion43} y \eqref{eq:ecuacion44}, como podemos ver esta función es un método recursivo que tiene como entradas a $vEntrada$ y $N$, que son el vector de datos de la señal (rellenado con ceros) y el tamaño de este vector respectivamente.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.7\textwidth]{Imagenes/Cap3/image023}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función de la transformada rápida de Fourier.}}
\label{fig:figura3.23}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\item[f)]Filtrado e integración o remuestreo por bandas críticas
\par
En la Figura \ref{fig:figura3.25} se muestra la función de remuestreo por bandas críticas, definido por las Ecuaciones desde \eqref{eq:ecuacion49} hasta \eqref{eq:ecuacion57}, esta función tiene como entradas a $fmin$ y a $fmax$ que son la frecuencia mínima y máxima de la señal respectivamente.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.72\textwidth]{Imagenes/Cap3/image025}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función de remuestreo por bandas críticas.}}
\label{fig:figura3.25}
{\small{Fuente: Propia}}
\end{center}
\end{figure}
\newpage
\item[g)]Obtención de los coeficientes MFCC
\par
La Figura \ref{fig:figura3.26} muestra la función para la obtención de los coeficientes MFCC, definido por las Ecuaciones \eqref{eq:ecuacion63}, \eqref{eq:ecuacion64} y \eqref{eq:ecuacion65}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image026}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función para la obtención de coeficientes MFCC.}}
\label{fig:figura3.26}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\item[i)]Alineamiento temporal dinámico
\par
En la Figura \ref{fig:figura3.32} se muestra la función DTW Simétrico con $P = 1/2$ sin ventana de ajuste.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.79\textwidth]{Imagenes/Cap3/image032}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función de DTW simétrico con P = 1/2 sin ventana de ajuste.}}
\label{fig:figura3.32}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\item[j)]Construcción del patrón de referencia
\par
En la Figura \ref{fig:figura3.34} se muestra la función para la construcción de los patrones de referencia, definido por la Ecuación \eqref{eq:ecuacion101}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.7\textwidth]{Imagenes/Cap3/image034}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función para la construcción del patrón de referencia.}}
\label{fig:figura3.34}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\end{enumerate}

\newpage
\subsubsection{Software de administración de usuarios}
A continuación, mostraremos algunas de las interfaces gráficas de usuario del software de aplicación del sistema de control de acceso por reconocimiento de voz. En la Figura \ref{fig:figura3.35} podemos ver la primera interfaz que se mostrará después de haber instalado la aplicación en el dispositivo móvil Android, donde tendremos dos opciones \textit{Iniciar} y \textit{Crear Cuenta}. La primera es cuando ya se tiene un usuario del tipo \textit{Administrador}, pero sin tener aún el registro de su patrón de voz de clave de acceso, en caso de no ocurrir esto entonces se escogerá la segunda opción.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image035}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Inicio de sesión al sistema por primera vez.}}
\label{fig:figura3.35}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
Después de registrar el usuario \textit{Administrador} del sistema (esto solo se hará una sola vez), la opción \textit{Crear Cuenta} desaparecerá.
\newpage
En la Figura \ref{fig:figura3.39} se muestra las opciones del menú principal del sistema que son: \textit{Comandos por Voz}, \textit{Cerrar Sesión}, \textit{Micrófono Externo}, \textit{Dispositivo Arduino}, \textit{Administrar Cuentas} y \textit{Consultar Accesos}, donde estos dos últimos solo se mostrarán para usuarios del tipo \textit{Administrador}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image039}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Menú principal del sistema.}}
\label{fig:figura3.39}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.40} se puede ver la interfaz para la opción del menú principal \textit{Administrar Cuentas}, donde se muestra una lista de las cuentas de los usuarios del sistema. La opción con el \textit{ícono de lupa} es para buscar usuarios, esta búsqueda puede ser por su nombre o DNI (Documento Nacional de Identidad), la opción con el \textit{ícono del mas} es para registrar un nuevo usuario al sistema, además al seleccionar un usuario de la lista podemos ver y editar sus datos.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image040}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Lista de cuentas de usuario del sistema.}}
\label{fig:figura3.40}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.41} se muestra la interfaz para registrar a un nuevo usuario al sistema, donde en \textit{tipo} se especificará que tipo de acceso tendrá este usuario al sistema, si es \textit{Administrador} tendrá todos los privilegios del sistema, si es \textit{Normal} no podrá registrar ni editar los datos de los usuarios ni tampoco podrá consultar los accesos de estos al sistema y si es \textit{Sin Acceso} se le denegará el acceso al sistema.
\vskip 0.5cm
En la Figura \ref{fig:figura3.42} se muestra el menú con las opciones \textit{Guardar}, \textit{Patrón de Voz} y \textit{Comando de Voz}. El primero es para guardar el registro o el editado de los datos de un usuario. El segundo es para poder asignar un patrón de voz clave al usuario que le permitirá acceder al sistema. Y la última opción es para asignar los comandos de voz que realizará el sistema por parte del usuario.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image041}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Registrar un nuevo usuario al sistema.}}
\label{fig:figura3.41}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image042}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Menú de opciones para la administración de usuarios del sistema.}}
\label{fig:figura3.42}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\newpage
En la Figura \ref{fig:figura3.43} se muestra la lista de audios de los patrones de voz que conforman la clave de acceso de un usuario, esta interfaz se muestra a través de la opción \textit{Patrones de Voz} del menú de opciones que se vió en la Figura \ref{fig:figura3.42}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image043}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Lista de audios del patrón clave de usuario para el acceso al sistema.}}
\label{fig:figura3.43}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.45} se muestra la interfaz para la grabación de un nuevo audio, a través de la opción con \textit{ícono de mas} que se vió en la interfaz anterior en la Figura \ref{fig:figura3.43}. Como podemos ver en esta interfaz al inicio se muestran tres opciones, la primera es para iniciar la grabación, la segunda es para reproducir la grabación y la tercera es para regresar a la lista de audios. Una vez terminada la grabación se mostrarán las opciones de \textit{cancelar} y \textit{aceptar} el almacenamiento del audio en la base datos, \textit{grabar} un nuevo audio, \textit{reproducir} el audio grabado, y por ultimo ir a la \textit{lista de audios}, ver la Figura \ref{fig:figura3.45}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image045}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Opciones despúes de grabar un audio en el sistema.}}
\label{fig:figura3.45}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.47} podemos ver la lista de los accesos de los usuarios del sistema, esta se mostrará a través de la opción \textit{Consultar Accesos} del menú principal del sistema mostrado en la Figura \ref{fig:figura3.39}. En esta interfaz se puede realizar búsquedas por DNI del usuario o por fecha de acceso al sistema, a través de la opción con \textit{ícono de lupa}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image047}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Lista de los accesos de los usuarios en el sistema.}}
\label{fig:figura3.47}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.50} podemos observar la interfaz que nos permitirá realizar el reconocimiento del usuario para su acceso al sistema, así como los comandos de voz. En la figura se muestra la grabación de un comando de voz para su reconocimiento por parte del sistema, a través de la opción con \textit{ícono de micrófono} (el tiempo máximo de grabación es de un minuto), una vez terminada la grabación esta puede ser cancelada o enviada para su procesamiento y reconocimiento del comando de voz. Además través de la opción con \textit{ícono de cámara}, nos permitirá cambiar la foto de la cuenta que ha iniciado sesíon, para ello se abrirá la cámara del dispositivo para poder tomar la foto.

\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image050}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Cancelar o enviar el comando de voz para su reconocimiento.}}
\label{fig:figura3.50}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En el reconocimiento pueden darse los resultados de \textit{usuario reconocido, usuario no reconocido, usted no es el usuario, comando reconocido o comando no reconocido.} En la Figura \ref{fig:figura3.51} se muestra el reconocimiento del comando de voz \textit{encender}. Para esta aplicación solo se reconocerán los comandos \textit{encender}, \textit{apagar} y \textit{jarvis}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image051}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Reconocimiento del comando de voz encender.}}
\label{fig:figura3.51}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
Después de dar en la opción \textit{Cerrar Sesión} del menú principal de la Figura \ref{fig:figura3.39}, nos llevará a la pantalla principal. En la Figura \ref{fig:figura3.60} se muestra el menú principal antes de iniciar sesión al sistema con una cuenta de usuario. Para iniciar sesión debemos ir a la opción \textit{Iniciar Sesión} del menú principal, donde se nos mostrará la interfaz para poder hacer la grabación del patrón clave de voz a reconocer, esta interfaz es la misma que para grabar comandos que se vió en la Figura \ref{fig:figura3.50}. Si el patrón clave de acceso es incorrecto, o si el usuario todavía no se ha registrado o si un usuario quiere hacerse pasar por otro usuario se mostrará un mensaje de error, tal como se ve en la Figura \ref{fig:figura3.54}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.55\textwidth]{Imagenes/Cap3/image054}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Respuestas después de tratar de acceder al sistema.}}
\label{fig:figura3.54}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
En la Figura \ref{fig:figura3.60} se muestra un mensaje de error al momento de establecer la comunicación con el Arduino para el control del hardware del sistema, a través de la opción \textit{Dispositivo Arduino} del menú principal, esto se debe a que el Arduino se encuentra apagado. Por otro lado, en la Figura \ref{fig:figura3.61} se muestra un mensaje de una conexión correcta con el Arduino, permitiendo así el control del hardware del sistema.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image060}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Error en la conexión con arduino.}}
\label{fig:figura3.60}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.25\textwidth]{Imagenes/Cap3/image061}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Conexión establecida con arduino.}}
\label{fig:figura3.61}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\subsection{Construcción del hardware}
\subsubsection{Instrumentos}
\begin{enumerate}
\item[-]Un dispositivo móvil con Android 8.0, memoria RAM 3GB y CPU 4x1.4GHz.
\item[-]Un computador con Windows 10, memoria RAM 8GB y CPU Intel Core i5 2x2.60GHz.
\item[-]Un módem router pasarela con tecnología 802.11 b,g,n.
\item[-]Un Arduino Mega 2560 R3.
\item[-]Un módulo Ethernet Shield W5100 compatible con Arduino Mega.
\item[-]Un módulo relé 4 Songle 10A 250VAC.
\item[-]Un transformador DC 9-12V 1A.
\item[-]Un transformador DC 5V 500mA.
\item[-]Un transformador DC 12V 1A.
\item[-]Una cerradura eléctrica YALE.
\item[-]Un foco ahorrador de 200V y 65W.
\end{enumerate}
\subsubsection{Diseño del hardware del sistema}
En la Figura \ref{fig:figura3.69} se muestra el diseño del hardware para nuestro sistema de seguridad por reconocimiento de voz, en dicho diagrama se indica la conexión e integración de cada componente que conforman el hardware del sistema. A continuación, explicaremos el rol que cumple cada componente en el funcionamiento del sistema.
\vskip 0.5cm
El arduino mega, este microcontrolador almacena el código fuente que nos permitirá controlar la activación o desactivación de la cerradura eléctrica y el foco, a través de un dispositivo móvil android, para ello se nececita establecer una comunicación inalámbrica con este, es por eso que se utiliza el componente ethernet shield, el cuál nos permite conectar el arduino mega a una red por medio de un cable UTP con entradas de tipo RJ45, y este es conectado a un router o móden.
\vskip 0.5cm
En cuanto al módulo relé, este componente su función es transformar el voltaje de la corriente eléctrica de 0V a 5V proveniente del arduino mega a 220V, que es usada para la activación del foco y de la cerradura eléctrica, pero para este último se requiere para su funcionamiento 12V, por lo que se usa un tranformador reductor de potencial.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.62\textwidth]{Imagenes/Cap3/image069}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Diseño del hardware del sistema de reconocimiento de voz.}}
\label{fig:figura3.69}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\subsubsection{Implementación del hardware del sistema}
En la Figura \ref{fig:figura3.70} se muestra la implementación del hardware de nuestro sistema de seguridad por reconocimiento de voz.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.42\textwidth]{Imagenes/Cap3/image070}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Implementación del hardware del sistema de reconocimiento de voz.}}
\label{fig:figura3.70}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\vskip -0.5cm
\newpage
\section{Fase 3. Testeo del sistema}
En esta etapa del desarrollo utilizaremos a 5 personas del sexo masculino con edades entre 20 y 22 años, donde cada uno de ellos dirá los números del 1 al 10, repitiendo este proceso 5 veces, el entorno de grabación será en un ambiente controlado (sin ruido).
\vskip 0.5cm
Una vez recolectado las 250 grabaciones, donde cada persona pronunció cada número 5 veces, 3 de ellos los utilizaremos para la etapa de entrenamiento (150 audios) y los 2 restantes para el testeo del sistema (100 audios). Las grabaciones se realizaron con una frecuencia de muestro de 16000 Hz, canal mono, 16 bits de cuantificación y la codificación Little-Endian.
\vskip 0.5cm
A continuación, veremos los resultados obtenidos de las evaluaciones para cada configuración del algoritmo de reconocimiento de voz, mostrando el número de reconocimientos incorrectos obtenidos, donde \textit{min} es el número mínimo de errores (desaciertos en el reconocimiento) obtenidos para una configuración (algoritmo con determinados valores en los parámetros), \textit{prom} es el valor promedio de los errores obtenidos para una configuración, y finalmente \textit{error} es el promedio de los valores \textit{prom} obtenidos.

% ------------------- TABLAS -----------------------%
\input{TablasCap3}
% --------------------------------------------------%

\subsection{Evaluar algoritmo para la detección de inicio y fin de la señal de voz}
Ahora pasaremos a escoger el mejor algoritmo para la etapa de Detección de Inicio y Fin de la Señal de Voz, teniendo la siguiente configuración del algoritmo: \\
- Eliminación de Segmentos Inútiles por Energía \\
\hspace*{1cm} T = 192 ; \qquad E = 3 \\
- Algoritmo de Rabiner \& Sambur de Tipo 1 \\
\hspace*{1cm} T = 128 \\
- Algoritmo de Rabiner \& Sambur de Tipo 2 \\
\hspace*{1cm} T = 128 

La grabación se realizó con una frecuencia de muestreo de 16000 Hz, canal mono, 16 bits de cuantificación y la codificación Little Endian, se pronunció la palabra \texttt{manzana} y no se controló el ruido para ver como se comportan los algoritmos ante este evento.

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image074}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Resultado del testeo para el \texttt{audio\_2.wav} por algoritmo de función de energía.}}
\label{fig:figura3.74}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\vskip -1.0cm

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image075}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Resultado del testeo para el \texttt{audio\_2.wav} por algoritmo de Rabiner \& Sambur tipo 1.}}
\label{fig:figura3.75}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\vskip -1.0cm

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image076}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Resultado del testeo para el \texttt{audio\_2.wav} por algoritmo de Rabiner \& Sambur tipo 2.}}
\label{fig:figura3.76}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

De las Figuras \ref{fig:figura3.74}, \ref{fig:figura3.75} y \ref{fig:figura3.76} vemos que el algoritmo de Rabiner \& Sambur Tipo 1 recortó a la señal de voz mejor con respecto a los otros algoritmos, por lo tanto, se escogerá a este algoritmo para la etapa de Detección de Inicio y Fin de la Señal de Voz.

\subsection{Evaluar algoritmo para la eliminación de ruido aditivo}
Ahora pasaremos ah escoger el mejor algoritmo para la etapa de \textit{Eliminación de Ruido}, teniendo como configuración del algoritmo de reconocimiento de voz para el sistema: \\
- Algoritmo LMS\\
\hspace*{1cm} M = 128 ; \qquad $\mu$ = 0.02 y 0.002\\
- Algoritmo NLMS \\
\hspace*{1cm} M = 128 ; \qquad $\beta$ = 0.25, 0.025 y 0.0025 ; \qquad c = 0.0001
\vskip 0.5cm
Estas pruebas se realizaron con un micrófono primario ubicado a 2 metros de la fuente de ruido (en este caso fue la melodía de un celular) y un segundo micrófono ubicado a 50 cm de la fuente de ruido. Los micrófonos que se usaron fueron las de dos laptops y la palabra que se pronunció fue \textit{uno}, la grabación se realizó con una frecuencia de muestreo de 16000 Hz, canal mono, 16 bits de cuantificación y la codificación Little Endian.
\vskip 0.5cm
En la Figura \ref{fig:figura3.77} se muestra la señal de voz contaminada por el ruido capturada por el primer micrófono y en la Figura \ref{fig:figura3.78} se muestra la señal producida por la fuente de ruido capturada por el segundo micrófono.

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image077}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Grafica de la señal de voz contaminada \texttt{voz\_ruido.wav}.}}
\label{fig:figura3.77}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\vskip -1.0cm

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image078}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Grafica de la señal de ruido \texttt{ruido.wav}.}}
\label{fig:figura3.78}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image080}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Grafica de la señal después de aplicar LMS con $\mu$ =0.002.}}
\label{fig:figura3.80}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\vskip -1.0cm

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.65\textwidth]{Imagenes/Cap3/image083}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Grafica de la señal después de aplicar NLMS con $\beta$ =0.0025.}}
\label{fig:figura3.83}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

Las Figuras \ref{fig:figura3.80} y \ref{fig:figura3.83} se muestran los mejores resultados para cada algoritmo de esta prueba, podemos concluir que el mejor resultado para la eliminación de ruido lo obtuvo el NLMS con $\beta = 0.0025$, observamos que el ruido tiene una amplitud baja con respecto a la de la voz, por lo que resultará un mejor caso para la etapa de \textit{Detección de Inicio y Fin de la Señal de Voz}. Finalmente, podemos concluir de esta etapa de Testeo del Sistema que la configuración que tendrá el algoritmo de reconocimiento de voz para el sistema, es el siguiente:

\begin{enumerate}
\item[•]Etapa de Eliminación de Ruido: 
\par
\hspace*{1cm} - Algoritmo NLMS \\
\hspace*{2cm} M = 128 ; \qquad $\beta$ = 0.0025 ; \qquad c = 0.0001

\item[•]Etapa de Detección de Inicio y Fin de la Señal de Voz: 
\par
\hspace*{1cm} - Algoritmo Rabinner \& Sambur Tipo 1 \\
\hspace*{2cm} T = 128

\item[•]Etapa de Entrenamiento: 
\par
\hspace*{1cm} - Filtro Preénfasis \\
\hspace*{2cm} $\alpha$ = 0.95 \\
\hspace*{1cm} - Segmentación por Hamming \\
\hspace*{2cm} V = 28 ; \qquad S = 18 \\
\hspace*{1cm} - Algoritmo MFCC \\
\hspace*{2cm} BC = 24 ; \qquad M = 15

\item[•]Etapa de Reconocimiento: 
\par
\hspace*{1cm} - Algoritmo DTW Simétrico \\
\hspace*{2cm} P = 1/2 ; \qquad R = 40 ; \qquad D = Error Cuadrático Medio \\
\end{enumerate}

\section{Fase 4. Mantenimiento del sistema}
Lo que haremos en esta etapa será implementar la configuración (funciones y parámetros óptimos) del algoritmo de reconocimiento de voz obtenida en la etapa de Testeo del Sistema, en la aplicación para el dispositivo móvil, además añadiremos a este el algoritmo el módulo de la toma de decisión, para luego poder probar nuestro sistema en un ambiente real.
\vskip 0.5cm
En la Figura \ref{fig:figura3.85} se muestra el código fuente del algoritmo para obtener el patrón característico (coeficientes MFCC) de una señal, usado en la etapa de entrenamiento.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image085}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente del algoritmo de reconocimiento de voz para la etapa de entrenamiento.}}
\label{fig:figura3.85}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
\newpage
En la Figura \ref{fig:figura3.86} se muestra el código fuente del algoritmo para obtener el patron más parecido (menor medida de distancia) para una señal, usado en la etapa de reconocimiento.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image086}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente del algoritmo de reconocimiento de voz para la etapa de reconocimiento.}}
\label{fig:figura3.86}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

En la Figura \ref{fig:figura3.87} se muestra el código fuente del algoritmo para obtener la respuesta del sistema (identificación correcta, no identificación y falsa identificación) ante la comparación de dos señales de voz, usado en la etapa de toma de desición.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image087}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente del algoritmo de reconocimiento de voz para la etapa de toma de decisión.}}
\label{fig:figura3.87}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

En las Figuras \ref{fig:figura3.88} y \ref{fig:figura3.89} se muestran las funciones para obtener los umbrales para la toma de desición del sistema definido por las Ecuaciones \eqref{eq:ecuacion105} y \eqref{eq:ecuacion106}.
\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image088}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente de la función de cálculo del umbral de decisión.}}
\label{fig:figura3.88}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}

\begin{figure}[H]
\captionsetup{justification=centering}
\begin{center}
\includegraphics[width=0.85\textwidth]{Imagenes/Cap3/image089}
\end{center}
\begin{center}
\vskip -0.5cm
\caption{\small{Código fuente para la obtención de los umbrales de decisión para cada patrón de entrenamiento.}}
\label{fig:figura3.89}
{\small{Fuente: Elaboración propia}}
\end{center}
\end{figure}
